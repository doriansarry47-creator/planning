# üîß Correction de l'erreur serveur 500 - TypeScript

## ‚ùå Probl√®mes identifi√©s

### 1. Erreur TypeScript sur Vercel
```
TypeError [ERR_UNKNOWN_FILE_EXTENSION]: Unknown file extension ".ts" for /var/task/server/routes/auth.ts
```

**Cause**: Les importations dans `api/index.ts` utilisaient `.ts` au lieu de `.js`

### 2. Compte admin manquant
Le compte admin avec l'email `doriansarry47@gmail.com` n'√©tait pas configur√©.

## ‚úÖ Solutions appliqu√©es

### 1. Correction des importations TypeScript

**Avant** (‚ùå):
```typescript
import authRoutes from '../server/routes/auth.ts';
import practitionersRoutes from '../server/routes/practitioners.ts';
```

**Apr√®s** (‚úÖ):
```typescript
// Importations dynamiques pour √©viter les erreurs de compilation
async function loadRoutes() {
  const { default: authRoutes } = await import('../server/routes/auth.js');
  const { default: practitionersRoutes } = await import('../server/routes/practitioners.js');
  // ...
}
```

### 2. Configuration du compte administrateur

Cr√©√© le script `scripts/create-admin.ts` qui:
- ‚úÖ Cr√©e le compte admin avec email: `doriansarry47@gmail.com`
- ‚úÖ Configure le mot de passe: `admin123`
- ‚úÖ Active le compte automatiquement
- ‚úÖ Met √† jour si le compte existe d√©j√†

### 3. Script de d√©ploiement

Cr√©√© `scripts/deploy-setup.ts` pour:
- ‚úÖ V√©rifier la connexion DB
- ‚úÖ Cr√©er/mettre √† jour l'admin
- ‚úÖ Tester les endpoints
- ‚úÖ Confirmer la configuration

## üöÄ D√©ploiement sur Vercel

### Commandes √† ex√©cuter apr√®s d√©ploiement:

```bash
# 1. Configurer les variables d'environnement sur Vercel
DATABASE_URL=postgresql://...
JWT_SECRET=medplan-jwt-secret-key-2024-production
SESSION_SECRET=medplan-session-secret-2024-production
NODE_ENV=production

# 2. Apr√®s le d√©ploiement, ex√©cuter le setup
npm run deploy:setup
```

### Variables d'environnement requises sur Vercel:

```env
DATABASE_URL=postgresql://neondb_owner:password@ep-autumn-bar-abt09oc2-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require
JWT_SECRET=medplan-jwt-secret-key-2024-production
SESSION_SECRET=medplan-session-secret-2024-production
NODE_ENV=production
```

## üì° Endpoints API corrig√©s

Apr√®s correction, ces endpoints sont disponibles:

### Authentification
- `POST /api/auth/register/patient` - Inscription patient
- `POST /api/auth/register/admin` - Inscription admin (prot√©g√©)
- `POST /api/auth/login/patient` - Connexion patient
- `POST /api/auth/login/admin` - Connexion admin
- `GET /api/auth/verify` - V√©rification token

### Gestion
- `GET /api/health` - Status de l'API
- `GET /api/practitioners` - Liste des praticiens
- `GET /api/appointments` - Rendez-vous
- `GET /api/patients` - Patients (prot√©g√©)

## üîë Informations de connexion admin

```
Email: doriansarry47@gmail.com
Mot de passe: admin123
```

## üß™ Tests post-d√©ploiement

### 1. Test de sant√© de l'API
```bash
curl https://votre-app.vercel.app/api/health
```

### 2. Test de connexion admin
```bash
curl -X POST https://votre-app.vercel.app/api/auth/login/admin \
  -H "Content-Type: application/json" \
  -d '{"email":"doriansarry47@gmail.com","password":"admin123"}'
```

### 3. Test d'inscription patient
```bash
curl -X POST https://votre-app.vercel.app/api/auth/register/patient \
  -H "Content-Type: application/json" \
  -d '{
    "email":"test@example.com",
    "password":"TestPassword123",
    "firstName":"Test",
    "lastName":"User"
  }'
```

## üîß Fichiers modifi√©s

1. ‚úÖ `api/index.ts` - Importations dynamiques
2. ‚úÖ `scripts/create-admin.ts` - Script de cr√©ation admin
3. ‚úÖ `scripts/deploy-setup.ts` - Script de setup d√©ploiement  
4. ‚úÖ `package.json` - Nouvelles commandes
5. ‚úÖ `.env` - Variables d'environnement

## ‚ö†Ô∏è Notes importantes

1. **Base de donn√©es**: Assurez-vous que `DATABASE_URL` est correctement configur√© sur Vercel
2. **S√©curit√©**: Changez les secrets JWT en production
3. **Admin**: Le compte admin est automatiquement activ√©
4. **CORS**: Configur√© pour accepter toutes les origines en production Vercel

## üìû Support

Si les erreurs persistent apr√®s ces corrections:

1. V√©rifiez les logs Vercel
2. Testez la connexion √† la base de donn√©es
3. V√©rifiez les variables d'environnement
4. Ex√©cutez `npm run deploy:setup` apr√®s le d√©ploiement