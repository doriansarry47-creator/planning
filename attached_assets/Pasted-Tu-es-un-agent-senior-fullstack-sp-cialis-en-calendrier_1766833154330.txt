Tu es un agent senior fullstack sp√©cialis√© en calendriers iCal, gestion de disponibilit√©s,
timezone, Node.js, TypeScript, Vercel, TRPC et syst√®mes de r√©servation.

CONTEXTE
========
J‚Äôai une API TRPC `getAvailabilitiesByDate` qui :
- R√©cup√®re un iCal Google Calendar
- D√©tecte les √©v√©nements "üü¢ DISPONIBLE" comme des cr√©neaux ouverts
- D√©tecte les √©v√©nements RDV / R√âSERV√â comme des blocages
- Filtre ensuite les cr√©neaux pour ne garder que ceux :
  - dans la p√©riode demand√©e
  - dans le futur
  - non d√©j√† r√©serv√©s en base de donn√©es

PROBL√àME
========
Visuellement, le calendrier contient BEAUCOUP de cr√©neaux "DISPONIBLE".
Les logs confirment :
- 90 disponibilit√©s d√©tect√©es
- 12 blocages
- 45 rendez-vous en base

MAIS le r√©sultat final est :
‚û°Ô∏è 0 cr√©neaux bookables trouv√©s

Logs cl√©s :
- Beaucoup de lignes : "‚è≠Ô∏è Disponibilit√© hors p√©riode"
- Beaucoup de lignes : "‚ùå Cr√©neau filtr√© (r√©serv√© dans BD)"
- Timezone serveur = UTC
- iCal Google Calendar (probablement Europe/Paris)
- Les DISPONIBLE sont souvent √† 17:30 ou 18:30 heure locale

OBJECTIF
========
Identifier pr√©cis√©ment POURQUOI tous les cr√©neaux DISPONIBLE sont √©limin√©s
et proposer une correction robuste.

CE QUE TU DOIS FAIRE
====================
1Ô∏è‚É£ ANALYSE
- Lire attentivement les logs fournis
- Identifier les causes probables :
  - Probl√®me de timezone (UTC vs local)
  - Mauvaise comparaison startDate / endDate
  - Erreur de normalisation des dates (startOfDay / endOfDay)
  - Conflit entre iCal et BD (cl√© date+heure mal align√©e)
  - Suppression globale d‚Äôun cr√©neau DISPONIBLE √† cause d‚Äôun RDV partiel

2Ô∏è‚É£ DIAGNOSTIC PR√âCIS
Pour chaque hypoth√®se :
- Explique pourquoi elle est plausible
- Cite les lignes de log qui le prouvent
- Dis si elle peut √† elle seule provoquer "0 cr√©neau bookable"

3Ô∏è‚É£ CORRECTION TECHNIQUE
Proposer une solution claire et concr√®te :
- Normalisation des dates (UTC ‚Üî timezone locale)
- Comparaison robuste des p√©riodes
- Matching exact entre cr√©neau iCal et RDV BD
- Gestion correcte des √©v√©nements partiels (un RDV ne doit bloquer qu‚Äôun seul slot, pas toute la plage)

4Ô∏è‚É£ CODE
Fournir :
- Un exemple TypeScript clair pour :
  - Normaliser les dates
  - Comparer correctement les cr√©neaux
  - Corriger le filtrage "hors p√©riode"
- Si n√©cessaire, proposer l‚Äôusage de :
  - date-fns-tz ou luxon
  - une fonction utilitaire unique de parsing iCal

5Ô∏è‚É£ R√àGLES M√âTIER √Ä RESPECTER
- Un √©v√©nement "DISPONIBLE" = cr√©neau ouvrable
- Un RDV ne bloque QUE l‚Äôintervalle exact
- La suppression d‚Äôun DISPONIBLE ne doit jamais supprimer toute une journ√©e
- Les cr√©neaux doivent √™tre bookables s‚Äôils sont visibles c√¥t√© Google Calendar

6Ô∏è‚É£ LIVRABLE FINAL
- R√©sum√© du bug principal
- Liste des corrections √† appliquer
- Code corrig√© ou pseudo-code pr√©cis
- Checklist de tests √† faire apr√®s correction

IMPORTANT
=========
- Sois pr√©cis, pas vague
- Ne propose pas 10 solutions abstraites
- Agis comme si tu devais livrer le correctif aujourd‚Äôhui en production
