#!/bin/bash

echo "üöÄ GUIDE DE R√âSOLUTION - API Routes"
echo "=================================="
echo ""

echo "üìä DIAGNOSTIC ACTUEL :"
echo "‚úÖ Google Calendar : INITIALIS√â"
echo "‚úÖ Credentials OAuth2 : ACTIFS"  
echo "‚úÖ Refresh Token : CONFIGUR√â"
echo "‚ùå Routes TRPC : 404 NOT FOUND"
echo "‚ùå Routes OAuth : 404 NOT FOUND"
echo ""

echo "üîß ACTIONS REQUISES :"
echo ""
echo "1Ô∏è‚É£ RED√âPLOIEMENT VERCEL :"
echo "   - Allez sur https://vercel.com/dashboard"
echo "   - S√©lectionnez le projet 'planning'"
echo "   - Cliquez sur 'Deployments'"
echo "   - Cliquez sur 'Redeploy' (bouton sur le dernier d√©ploiement)"
echo "   - Attendez le rebuild complet"
echo ""

echo "2Ô∏è‚É£ V√âRIFICATION ENVIRONNEMENT :"
echo "   - Settings ‚Üí Environment Variables"
echo "   - V√©rifiez que GOOGLE_REFRESH_TOKEN est d√©fini :"
echo "     1//036wt8eMutncaCgYIARAAGAMSNwF-L9IrYYVjwaU8Aom2Xu31hFufKfxX8TiMsCqa6Am8bdSzXUYk0hbKilAvYukmI47egIUWd5M"
echo ""

echo "3Ô∏è‚É£ TESTS POST-D√âPLOIEMENT :"
echo ""
echo "   Test 1 - Health Check :"
echo "   curl https://planning-7qkb7uw7v-ikips-projects.vercel.app/api/health"
echo "   ‚Üí Doit retourner : {\"status\":\"ok\",\"googleCalendar\":\"initialized\"}"
echo ""

echo "   Test 2 - TRPC Endpoint :"
echo "   curl -X POST https://planning-7qkb7uw7v-ikips-projects.vercel.app/api/trpc/booking.getAvailableSlots \\"
echo "        -H 'Content-Type: application/json' \\"
echo "        -d '{\"input\": {\"date\": \"2025-12-08\"}}'"
echo "   ‚Üí Doit retourner les cr√©neaux disponibles"
echo ""

echo "   Test 3 - Page Patient :"
echo "   Ouvrir : https://planning-7qkb7uw7v-ikips-projects.vercel.app/book-appointment"
echo "   ‚Üí Doit afficher les cr√©neaux de rendez-vous (plus de 'Chargement...')"
echo ""

echo "4Ô∏è‚É£ SI PROBL√àME PERSISTE :"
echo "   - V√©rifiez les logs Vercel dans l'onglet 'Functions'"
echo "   - Forcez un nouveau d√©ploiement depuis Vercel"
echo "   - Contactez-moi avec les logs d'erreur"
echo ""

echo "üéØ R√âSULTAT ATTENDU :"
echo "   ‚úÖ Cr√©neaux visibles sur /book-appointment"
echo "   ‚úÖ S√©lection de date fonctionnelle"
echo "   ‚úÖ Patients peuvent r√©server des RDV"
echo ""

echo "üìû SUPPORT :"
echo "   Si les routes TRPC restent 404 apr√®s red√©ploiement,"
echo "   envoyez-moi les logs Vercel pour diagnostic avanc√©."