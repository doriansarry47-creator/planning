# üöÄ Guide de D√©ploiement MedPlan v3.0 sur Vercel

## üìã Pr√©-requis

### Comptes n√©cessaires
1. **Compte Vercel** : https://vercel.com/signup
2. **Base de donn√©es Neon** : https://neon.tech (recommand√© pour Vercel)
3. **Compte Twilio** (optionnel pour SMS) : https://www.twilio.com
4. **Compte email SMTP** : Gmail, Yahoo, ou autre

### Outils locaux
- Node.js 18+ install√©
- Git install√©
- Vercel CLI : `npm install -g vercel`

---

## üìù √âtape 1 : Pr√©paration du Projet

### 1.1 Cloner et Installer

```bash
# Si pas d√©j√† fait
git clone <votre-repo>
cd medplan-vercel

# Installer les d√©pendances
npm install
```

### 1.2 V√©rifier la Configuration

V√©rifiez que les fichiers suivants existent :
- ‚úÖ `vercel.json` - Configuration Vercel
- ‚úÖ `package.json` - D√©pendances Node.js
- ‚úÖ `vite.config.ts` - Configuration Vite
- ‚úÖ `shared/schema.ts` ou `shared/schema-enhanced.ts` - Sch√©ma DB

---

## üóÑÔ∏è √âtape 2 : Configuration de la Base de Donn√©es

### 2.1 Cr√©er une base Neon PostgreSQL

1. Aller sur https://neon.tech
2. Cr√©er un nouveau projet
3. Copier l'URL de connexion (format : `postgresql://user:pass@host/db?sslmode=require`)

### 2.2 Initialiser le sch√©ma

```bash
# Cr√©er un fichier .env local
cp .env.example .env

# √âditer .env et ajouter votre DATABASE_URL
DATABASE_URL="postgresql://..."

# Lancer les migrations (si vous avez Drizzle configur√©)
npx drizzle-kit push:pg
```

### 2.3 Cr√©er les comptes admin initiaux

```bash
# Script pour cr√©er l'admin Dorian Sarry
npm run db:reset-admin
```

---

## ‚òÅÔ∏è √âtape 3 : D√©ploiement sur Vercel

### 3.1 Connexion √† Vercel

```bash
# Se connecter avec votre compte Vercel
vercel login
```

### 3.2 Configuration du Projet

```bash
# Initialiser le projet Vercel (premi√®re fois)
vercel

# R√©pondre aux questions :
# ? Set up and deploy "~/medplan-vercel"? [Y/n] Y
# ? Which scope do you want to deploy to? <votre-compte>
# ? Link to existing project? [y/N] N
# ? What's your project's name? medplan-app
# ? In which directory is your code located? ./
```

### 3.3 Configuration des Variables d'Environnement

**Option A : Via le Dashboard Vercel** (Recommand√©)

1. Aller sur https://vercel.com/dashboard
2. S√©lectionner votre projet `medplan-app`
3. Aller dans **Settings** ‚Üí **Environment Variables**
4. Ajouter les variables suivantes :

```env
# Base de donn√©es (OBLIGATOIRE)
DATABASE_URL=postgresql://user:pass@host/db?sslmode=require

# S√©curit√© (OBLIGATOIRE)
JWT_SECRET=votre-cl√©-jwt-tr√®s-s√©curis√©e-min-32-caract√®res
SESSION_SECRET=votre-cl√©-session-tr√®s-s√©curis√©e-min-32-caract√®res

# Email SMTP (Recommand√©)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=doriansarry@yahoo.fr
SMTP_PASS=votre-mot-de-passe-application

# SMS Twilio (Optionnel)
TWILIO_ACCOUNT_SID=votre-twilio-sid
TWILIO_AUTH_TOKEN=votre-twilio-token
TWILIO_PHONE_NUMBER=+33123456789

# Environnement
NODE_ENV=production
```

**Option B : Via CLI**

```bash
# Ajouter les variables une par une
vercel env add DATABASE_URL
vercel env add JWT_SECRET
vercel env add SESSION_SECRET
# ... etc
```

### 3.4 D√©ploiement en Production

```bash
# Build local pour v√©rifier
npm run build

# D√©ployer en production
vercel --prod
```

**R√©sultat :**
```
‚úÖ Production: https://medplan-app.vercel.app [3s]
```

---

## üîê √âtape 4 : Configuration de S√©curit√©

### 4.1 G√©n√©ration de Secrets S√©curis√©s

```bash
# G√©n√©rer des cl√©s secr√®tes al√©atoires
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Utiliser pour JWT_SECRET et SESSION_SECRET
```

### 4.2 Configuration SMTP Gmail (si utilis√©)

1. Activer la validation en 2 √©tapes sur Gmail
2. G√©n√©rer un "Mot de passe d'application" :
   - Aller dans Param√®tres Gmail ‚Üí S√©curit√©
   - "Mots de passe des applications"
   - G√©n√©rer un mot de passe pour "Autre (nom personnalis√©)"
3. Utiliser ce mot de passe dans `SMTP_PASS`

### 4.3 Configuration CORS (si n√©cessaire)

Si vous avez un domaine personnalis√©, mettez √† jour dans `api/_lib/response.ts` :

```typescript
const allowedOrigins = [
  'https://medplan-app.vercel.app',
  'https://votre-domaine.com'
];
```

---

## üß™ √âtape 5 : Tests Post-D√©ploiement

### 5.1 V√©rifier l'Application

1. **Page d'accueil** : https://medplan-app.vercel.app
   - ‚úÖ Devrait afficher la landing page

2. **Connexion admin** : https://medplan-app.vercel.app/login/admin
   - Email : `admin@medplan.fr`
   - Password : `admin123` (ou celui d√©fini)

3. **API Health Check** : https://medplan-app.vercel.app/api/health
   - ‚úÖ Devrait retourner `{ "status": "ok" }`

### 5.2 Tester les Fonctionnalit√©s

- [ ] Inscription patient
- [ ] Connexion patient
- [ ] Prise de rendez-vous
- [ ] Dashboard admin
- [ ] Gestion des praticiens
- [ ] Envoi d'emails de confirmation
- [ ] SMS de rappel (si configur√©)

### 5.3 V√©rifier les Logs

```bash
# Voir les logs en temps r√©el
vercel logs https://medplan-app.vercel.app --follow
```

---

## üîß √âtape 6 : Configuration Avanc√©e (Optionnel)

### 6.1 Domaine Personnalis√©

1. Aller dans **Settings** ‚Üí **Domains**
2. Ajouter votre domaine : `rdv.medplan-sarry.fr`
3. Configurer les DNS selon les instructions Vercel

### 6.2 Certificat SSL

- Automatique avec Vercel (Let's Encrypt)
- Aucune action requise

### 6.3 Analyse et Monitoring

**Vercel Analytics** (Gratuit)
```bash
# Installer le package
npm install @vercel/analytics

# Ajouter dans src/main.tsx
import { Analytics } from '@vercel/analytics/react';

// Dans le rendu
<Analytics />
```

**Sentry pour Error Tracking** (Optionnel)
```bash
npm install @sentry/react @sentry/tracing
```

### 6.4 Cron Jobs (Rappels Automatiques)

Cr√©er `api/cron/send-reminders.ts` :

```typescript
import type { VercelRequest, VercelResponse } from '@vercel/node';

export default async function handler(
  req: VercelRequest,
  res: VercelResponse
) {
  // V√©rifier le secret CRON
  if (req.headers.authorization !== `Bearer ${process.env.CRON_SECRET}`) {
    return res.status(401).json({ error: 'Unauthorized' });
  }

  // Logique d'envoi des rappels
  // ...

  res.json({ success: true, sent: 10 });
}
```

Ajouter dans `vercel.json` :

```json
{
  "crons": [
    {
      "path": "/api/cron/send-reminders",
      "schedule": "0 9 * * *"
    }
  ]
}
```

---

## üìä √âtape 7 : Monitoring et Maintenance

### 7.1 Surveiller les Performances

- **Vercel Dashboard** : Temps de r√©ponse, erreurs, bandwidth
- **Logs** : `vercel logs`
- **Analytics** : Visiteurs, pages vues

### 7.2 Sauvegardes Base de Donn√©es

**Neon automatique** : Sauvegardes quotidiennes incluses

**Sauvegarde manuelle** :
```bash
# Exporter la DB
pg_dump $DATABASE_URL > backup.sql

# Restaurer
psql $DATABASE_URL < backup.sql
```

### 7.3 Mises √† Jour

```bash
# Mettre √† jour les d√©pendances
npm update

# V√©rifier les vuln√©rabilit√©s
npm audit fix

# Red√©ployer
vercel --prod
```

---

## üêõ D√©pannage Commun

### Probl√®me : Build Failed

**Erreur TypeScript**
```bash
# V√©rifier localement
npm run build

# Corriger les erreurs TS
# Puis red√©ployer
```

**D√©pendances manquantes**
```bash
# V√©rifier package.json
npm install
npm run build
```

### Probl√®me : 500 Internal Server Error

**V√©rifier les logs**
```bash
vercel logs --follow
```

**Variables d'environnement manquantes**
- V√©rifier que `DATABASE_URL`, `JWT_SECRET`, `SESSION_SECRET` sont d√©finies

**Probl√®me de connexion DB**
- V√©rifier que Neon DB est accessible
- Tester la connexion : `psql $DATABASE_URL`

### Probl√®me : CORS Errors

Ajouter votre domaine dans `api/_lib/response.ts` :

```typescript
const allowedOrigins = [
  'https://medplan-app.vercel.app',
  'https://votre-nouveau-domaine.com'
];
```

### Probl√®me : Emails non re√ßus

**V√©rifier SMTP**
```bash
# Tester avec nodemailer localement
node test-email.js
```

**Gmail bloquant**
- Activer "Acc√®s moins s√©curis√©" (non recommand√©)
- Utiliser un "Mot de passe d'application" (recommand√©)

---

## üöÄ Checklist de D√©ploiement

Avant de consid√©rer le d√©ploiement comme termin√© :

- [ ] ‚úÖ Base de donn√©es Neon cr√©√©e et accessible
- [ ] ‚úÖ Variables d'environnement configur√©es sur Vercel
- [ ] ‚úÖ D√©ploiement r√©ussi (`vercel --prod`)
- [ ] ‚úÖ Page d'accueil accessible
- [ ] ‚úÖ Connexion admin fonctionne
- [ ] ‚úÖ Inscription patient fonctionne
- [ ] ‚úÖ Prise de RDV fonctionne
- [ ] ‚úÖ API r√©pond correctement
- [ ] ‚úÖ Emails de confirmation envoy√©s
- [ ] üü° SMS configur√©s (optionnel)
- [ ] üü° Domaine personnalis√© configur√© (optionnel)
- [ ] üü° Analytics activ√© (optionnel)
- [ ] üü° Cron jobs configur√©s (optionnel)

---

## üìû Support

### Documentation
- **Vercel** : https://vercel.com/docs
- **Neon** : https://neon.tech/docs
- **Drizzle ORM** : https://orm.drizzle.team/docs

### Communaut√©
- **Discord Vercel** : https://vercel.com/discord
- **GitHub Issues** : <votre-repo>/issues

---

## üìà Prochaines √âtapes

Apr√®s un d√©ploiement r√©ussi :

1. **Phase 1** (Mois 1-3) : Impl√©menter les am√©liorations UX du document `AMELIORATIONS_STRATEGIQUES.md`
2. **Phase 2** (Mois 4-8) : Ajouter fonctionnalit√©s premium (paiement, t√©l√©consultation)
3. **Phase 3** (Mois 9-15) : IA, mobile natif, marketplace

---

**F√©licitations ! üéâ Votre application MedPlan est maintenant en production !**

*Version 3.0 - 23 Octobre 2025*
