import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';
import { eq } from 'drizzle-orm';
import bcrypt from 'bcryptjs';
import * as schema from './shared/schema.js';

const DATABASE_URL = 'postgresql://neondb_owner:npg_6aG2wNlTWnsb@ep-autumn-bar-abt09oc2-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require';

async function testLogin() {
  try {
    console.log('üß™ Test de connexion admin local...\n');
    const sql = neon(DATABASE_URL);
    const db = drizzle(sql, { schema });
    
    const email = 'doriansarry@yahoo.fr';
    const password = 'admin123';
    
    console.log(`üìß Email: ${email}`);
    console.log(`üîë Password: ${password}\n`);
    
    // R√©cup√©rer l'admin
    const admins = await db.select().from(schema.admins).where(eq(schema.admins.email, email));
    
    if (admins.length === 0) {
      console.log('‚ùå Admin non trouv√©!');
      return;
    }
    
    const admin = admins[0];
    console.log(`‚úÖ Admin trouv√©: ${admin.name}`);
    
    // V√©rifier le mot de passe
    const isPasswordValid = await bcrypt.compare(password, admin.password);
    
    if (isPasswordValid) {
      console.log('‚úÖ Mot de passe valide!');
      console.log('\nüéâ Connexion r√©ussie!\n');
      console.log('Donn√©es admin:');
      console.log(`  - ID: ${admin.id}`);
      console.log(`  - Nom: ${admin.name}`);
      console.log(`  - Email: ${admin.email}`);
      console.log(`  - Cr√©√© le: ${admin.createdAt}`);
    } else {
      console.log('‚ùå Mot de passe invalide!');
    }
    
  } catch (error) {
    console.error('‚ùå Erreur:', error);
  }
}

testLogin();
